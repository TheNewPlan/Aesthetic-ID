<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Aesthetic Search Test</title>
	<!-- This Links to the Startpage stylesheet -->
	<link rel="stylesheet" type="text/css" href="searchstyle.css">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
	
	<script type="text/javascript">
	function process(){
		var projectOxford = document.link.newlink.value;
	}
		
	//***********************************************//
	//******************EMOTION API******************//
	//***********************************************//
	
	var max = [];
	var maxString = [];
	var emotions = ['anger', 'contempt', 'disgust', 'fear', 'happiness', 'neutral', 'sadness', 'surprise'];
	var emotionCounts = [0, 0, 0, 0, 0, 0, 0, 0];
	var faceCount;
	var mostOccurringEmotionString;
	var mostOccurringEmotionIndex;
	var emotionCountMaxIndices = [];
	var currentMax = 0	
		
    	function Emotion() {
        	$.ajax({
            		url: "https://api.projectoxford.ai/emotion/v1.0/recognize",
            		beforeSend: function(xhrObj){
                		// Request headers
                		xhrObj.setRequestHeader("Content-Type","application/json");
                		xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key","4a14fd4b5fe14a69bc024c0139a44910");
            		},
            		type: "POST",
            		// Request body
             		data: '{"url": "http://img14.deviantart.net/5c96/i/2010/076/a/e/happy_vs_sad_faces_by_visazseptiana.jpg"}',
        		})
        		.done(function(data) {
        			console.log(data);
				faceCount = data.length;
				
				for (var i = 0; i < faceCount; i++){
					maxString.push(0);
					max.push(0);
					if (data[i]['scores']['anger'] > max[i]){
						max[i] = data[i]['scores']['anger'];
						maxString[i] = 'anger';
					}
					if (data[i]['scores']['contempt'] > max[i]){
						max[i]= data[i]['scores']['contempt'];
						maxString[i] = 'contempt';
					}
					if (data[i]['scores']['disgust'] > max[i]){
						max[i] = data[i]['scores']['disgust'];
						maxString[i] = 'disgust';
					}
					if (data[i]['scores']['fear'] > max[i]){
						max[i] = data[i]['scores']['fear'];
						maxString[i] = 'fear';
					}
					if (data[i]['scores']['happiness'] > max[i]){
						max[i] = data[i]['scores']['happiness'];
						maxString[i] = 'happiness';
					}
					if (data[i]['scores']['neutral'] > max[i]){
						max[i] = data[i]['scores']['neutral'];
						maxString[i] = 'neutral';
					}
					if (data[i]['scores']['sadness'] > max[i]){
						max[i] = data[i]['scores']['sadness'];
						maxString[i] = 'sadness';
					}
					if (data[i]['scores']['surprise'] > max[i]){
						max[i] = data[i]['scores']['surprise'];
						maxString[i] = 'surprise';
					}
					
					// assign the number of emotions detected in the picture to their
					// corresponding indices in an array called emotions
					for (var j = 0; j < emotions.length; j++){
						if (maxString[i] == emotions[j]){
							emotionCounts[j]++;
						}
					}
				}
			    	alert('There are '+faceCount+' people in this picture');
			    	
			    	alert('Emotion counts are '+emotionCounts);
			    	
			    	for (var i = 0; i < faceCount; i++){
					alert('Face number '+(i+1)+' is '+maxString[i]);
				}
				
				for (var i = 0; i < emotions.length; i++){
					if (emotionCounts[i] > currentMax){
						currentMax = emotionCounts[i];
					}
				}
				
				for (var i = 0; i < emotions.length; i++){
					if (emotionCounts[i] == currentMax){
						emotionCountMaxIndices.push(i);
					}
				}
			
				alert('The emotionCountMaxIndices are '+emotionCountMaxIndices);
				
			})
        		.fail(function(error) {
        		console.log(error.getAllResponseHeaders());
        
            		alert("fail");
        	});
    	};
	
	</script>
</head>  

<body>
  <div id="main"> 
    <!-- Site Title  --->
    <h1 id="welcome">Aesthetic Emotion</h1>
    <!-- Search Bar -->
    <form class="field" id="searchform" name="link">
        <input type="text" name="newlink" id="searchterm" placeholder="Enter an Image URL">
        <button type="button" name="submit" onClick="process" id="search">F i n d T h e m</button>
    </form>
  </div>
</body>
</html>
